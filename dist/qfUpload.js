!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("qfUpload",[],t):"object"==typeof exports?exports.qfUpload=t():e.qfUpload=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var a=i[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s=1)}([function(e,t,i){"use strict";var n=i(5);t.a={name:"QfQiniuUpload",directives:{paste:n.a},props:{orderId:{type:String,default:""},title:{type:String,default:"文件上传"},dir:{type:String,default:"dev"},num:{type:Number,default:9},uploadType:{type:String,default:"1"},uploadName:{type:String,default:"24"},uploadStatus:{default:""},upNum:{type:Number,default:0},watermark:{type:Boolean,default:!0},watermarkImg:{type:String,default:""}},data:function(){return{upToken:"",maxSize:500,imgList:[],fileList:[],dialogImageUrl:"",dialogVisible:!1,uploadFoces:!1,showFileList:!0}},created:function(){},mounted:function(){},methods:{upNumAddSub:function(e){var t=this.upNum+e;this.$emit("update:upNum",t)},handleRemove:function(e,t){for(var i in this.imgList)e.id==this.imgList[i].id&&this.imgList.splice(i,1);this.$refs.upload.abort()},beforeRemove:function(e,t){if(e&&"success"===e.status)return this.$confirm("确定移除当前文件？")},handleExceed:function(e,t){this.$message.warning("当前限制选择 "+this.num+" 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")},beforeAvatarUpload:function(e){var t=this,i=this;return new Promise(function(n,a){var o=e.size/1024/1024,r=o<t.maxSize,s="image/jpeg"===e.type||"image/jpg"===e.type||"image/png"===e.type;r||a();var u=1;if(o>2&&o<=5?u=.9:o>5&&o<=10?u=.8:o>10&&(u=.7),s&&u){var l=new Image,d="";l.src=URL.createObjectURL(e),l.onload=function(){d=i.compressUpload(l,e,u),n(d)},l.onerror=function(){a()}}else n(e)})},handleChange:function(e,t){for(var i in this.imgList)if(this.imgList[i].uid==e.uid)return;this.imgList.push(e)},uploadFiles:function(e,t){var i=this;this.upNumAddSub(1),i.showFileList=!0;var n="",a="",o="",r="stage"===Object({NODE_ENV:"production"}).VUE_APP_TITLE?this.dir+"_dev":this.dir;if(n=t&&"paste"==t?e:e.file,o=n.name,this.uploadStatus){var s=o.split(".");1==this.uploadStatus?(o="免费品牌交付表"+this.dateFormat(new Date,"date")+"."+s[s.length-1],n=new File([n],o)):2==this.uploadStatus&&(o="营业执照."+s[s.length-1],n=new File([n],o))}a=r+"/"+(new Date).getTime()+"_"+o;var u={useCdnDomain:!0,concurrentRequestLimit:1},l=null;l=10==this.uploadType?{"x:type":""+this.uploadType,"x:typeId":1}:{"x:type":""+this.uploadType,"x:typeId":""+this.orderId,"x:field":""+this.uploadName,"x:val":""+this.uploadStatus};var d={fname:o,params:l},p={next:function(t){e.onProgress&&e.onProgress({percent:t.total.percent})},error:function(e){i.upNumAddSub(-1),i.$notify.closeAll(),i.$notify.error('"'+o+'"上传失败'),i.imgList.forEach(function(e,t){e.uid==n.uid&&i.imgList.splice(t,1)})},complete:function(e){i.upNumAddSub(-1),i.$notify.closeAll(),i.$notify.success('"'+o+'"上传成功'),i.imgList.forEach(function(e,t){e.uid==n.uid&&i.imgList.splice(t,1)}),i.$emit("getBig",e.uploads,i.uploadStatus)}};this.$notify({message:'"'+o+'"上传中...',duration:0}),this.$emit("qiniuFn",function(e){var t=qiniu.upload(n,a,e,d,u);t.subscribe(p)})},compressUpload:function(e,t,i){var n=this.$refs.qfUploadLogo,a=document.createElement("canvas"),o=a.getContext("2d"),r=(e.src.length,e.width),s=e.height;if(a.width=r,a.height=s,o.fillRect(0,0,a.width,a.height),o.drawImage(e,0,0,r,s),this.watermark){o.rotate(-20*Math.PI/180),o.translate(-r/2,-s/2),o.font="18px Vedana",o.fillStyle="#000",o.textAlign="center",o.textBaseline="Middle",o.globalAlpha=.15;for(var u=0;u<r/110;u++)for(var l=0;l<s/35;l++)if(u%2==l%2){var d=300*u,p=80*l;o.drawImage(n,d-180,p-30,93,36),o.fillText("电商服务大平台",d,p)}}var c=a.toDataURL("image/jpeg",i);return this.dataURLtoFile(c,t.name,t.type)},dataURItoBlob:function(e){var t=void 0;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var i=e.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(t.length),a=0;a<t.length;a+=1)n[a]=t.charCodeAt(a);return new Blob([n],{type:i})},dataURLtoFile:function(e,t,i){for(var n=e.split(","),a=(n[0].match(/:(.*?);/)[1],atob(n[1])),o=a.length,r=new Uint8Array(o);o--;)r[o]=a.charCodeAt(o);return new File([r],t,{type:i||"image/jpg"})},handlePaste:function(e){var t=this,i=this,n=null;if(!(e.clipboardData&&e.clipboardData.items[0]&&e.clipboardData.items[0].type&&e.clipboardData.items[0].type.indexOf("image")>-1))return void this.$message({type:"warning",message:"上传的文件必须为图片且无法复制本地图片且无法同时复制多张图片"});n=e.clipboardData.items[0].getAsFile();var a=new Image,o="";a.src=URL.createObjectURL(n),a.onload=function(){o=i.compressUpload(a,n,1),i.uploadFiles(o,"paste")},a.onerror=function(){t.$message.error("图片上传错误，请稍后重试！")}},upFoces:function(){this.uploadFoces=!0},upBlur:function(){this.uploadFoces=!1},dateFormat:function(e,t){if(e){e="string"==typeof e?e.replace(/-/g,"/"):e;var i=new Date(e),n=i.getFullYear(),a=i.getMonth()+1,o=i.getDate(),r=i.getHours(),s=i.getMinutes(),u=i.getSeconds();return a<10&&(a="0"+a),o<10&&(o="0"+o),r<10&&(r="0"+r),s<10&&(s="0"+s),u<10&&(u="0"+u),"date"==t?n+"-"+a+"-"+o:"month"==t?n+"-"+a:"time"==t?r+":"+s+":"+u:"md"==t?a+"."+o:n+"-"+a+"-"+o+" "+r+":"+s+":"+u}return""}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(2),a=[n.a],o=function(e){a.forEach(function(t){e.component(t.name,t)})};"undefined"!=typeof window&&window.Vue&&o(window.Vue),t.default={install:o,QfQiniuUpload:n.a}},function(e,t,i){"use strict";var n=i(3);n.a.install=function(e){e.component(n.a.name,n.a)},t.a=n.a},function(e,t,i){"use strict";var n=i(0),a=i(7),o=i(4),r=o(n.a,a.a,!1,null,null,null);t.a=r.exports},function(e,t){e.exports=function(e,t,i,n,a,o){var r,s=e=e||{},u=typeof e.default;"object"!==u&&"function"!==u||(r=e,s=e.default);var l="function"==typeof s?s.options:s;t&&(l.render=t.render,l.staticRenderFns=t.staticRenderFns,l._compiled=!0),i&&(l.functional=!0),a&&(l._scopeId=a);var d;if(o?(d=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},l._ssrRegister=d):n&&(d=n),d){var p=l.functional,c=p?l.render:l.beforeCreate;p?(l._injectStyles=d,l.render=function(e,t){return d.call(t),c(e,t)}):l.beforeCreate=c?[].concat(c,d):[d]}return{esModule:r,exports:s,options:l}}},function(e,t,i){"use strict";var n=i(6),a=function(e){e.directive("paste",n.a)};window.Vue&&(window.paste=n.a,Vue.use(a)),n.a.install=a,t.a=n.a},function(e,t,i){"use strict";t.a={inserted:function(e,t,i){e.addEventListener("paste",function(e){t.value(e)})}}},function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"upload-index"},[i("div",{directives:[{name:"paste",rawName:"v-paste",value:e.handlePaste,expression:"handlePaste"}],class:[e.uploadFoces?"upload-fo":"","upload-box"],attrs:{tabindex:"-1"},on:{focus:e.upFoces,blur:e.upBlur}},[i("p",[e._v("复制粘贴区域，鼠标点击此区域后可以使用ctrl+V的方式进行图片粘贴")]),e._v(" "),i("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"container","before-upload":e.beforeAvatarUpload,"http-request":e.uploadFiles,"on-remove":e.handleRemove,limit:e.num,"on-change":e.handleChange,"on-exceed":e.handleExceed,"file-list":e.imgList,drag:"",multiple:""}},[i("el-button",{attrs:{size:"mini",type:"primary"}},[e._v(e._s(e.title))]),e._v(" "),i("div",{staticClass:"annotation",attrs:{slot:"tip"},slot:"tip"},[e._v("PS: 单个文件不能大于"+e._s(e.maxSize)+"M")])],1)],1),e._v(" "),i("div",{staticStyle:{display:"none"}},[i("img",{ref:"qfUploadLogo",staticClass:"qf-upload-logo",attrs:{src:e.watermarkImg||"../../assets/qf_logo.png"}})])])},a=[],o={render:n,staticRenderFns:a};t.a=o}])});
//# sourceMappingURL=qfUpload.js.map